# 广播设计

## 原则

- ✅ **支持 Host 广播**：本机可以向所有 peer 广播消息
- ❌ **禁止 Peer 广播**：peer 发来的包不能被转发给其他 peer

## Host 广播

### 广播地址

```
fd00:zignet:ffff::1   - 广播给所有 peer
```

### 工作流程

```
┌─────────────────────────────────────────────────────────────┐
│ 1. 应用发送广播                                             │
│    应用 sendto(fd00:zignet:ffff::1:5000, data)              │
└─────────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│ 2. ZigNet 处理                                              │
│    从 tun 读到 IP 包                                        │
│    dst = fd00:zignet:ffff::1                                │
│        │                                                    │
│        ▼                                                    │
│    遍历所有已连接的 peer                                    │
│    分别加密发送给每个 peer                                  │
└─────────────────────────────────────────────────────────────┘
```

## Peer 入站处理

```
handleInbound(packet, srcPeer):
    dst = extractDstIP(packet)
    
    // ❌ 禁止广播
    if dst == fd00:zignet:ffff::1:
        drop(packet, "peer cannot broadcast")
        return
```

## 使用场景

- **实时音频广播**：Host 向所有 peer 推送音频流
- **游戏状态同步**：游戏服务器广播状态给所有玩家
- **服务发现**：Host 广播自己提供的服务

