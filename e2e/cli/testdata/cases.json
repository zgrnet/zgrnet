[
  {
    "name": "ctx_create_and_show",
    "description": "Create first context, verify it becomes current",
    "steps": [
      {"args": ["ctx", "create", "default"], "expect_exit": 0},
      {"args": ["ctx", "show"],              "expect_exit": 0, "expect_stdout": "default\n"}
    ]
  },
  {
    "name": "ctx_create_multiple_and_list",
    "description": "Create two contexts, verify list order",
    "steps": [
      {"args": ["ctx", "create", "alpha"],  "expect_exit": 0},
      {"args": ["ctx", "create", "beta"],   "expect_exit": 0},
      {"args": ["ctx", "list"],             "expect_exit": 0, "expect_stdout_contains": ["alpha", "beta"]}
    ]
  },
  {
    "name": "ctx_use_and_switch",
    "description": "Create two contexts, switch between them",
    "steps": [
      {"args": ["ctx", "create", "first"],  "expect_exit": 0},
      {"args": ["ctx", "create", "second"], "expect_exit": 0},
      {"args": ["ctx", "show"],             "expect_exit": 0, "expect_stdout": "first\n"},
      {"args": ["ctx", "use", "second"],    "expect_exit": 0},
      {"args": ["ctx", "show"],             "expect_exit": 0, "expect_stdout": "second\n"}
    ]
  },
  {
    "name": "ctx_delete",
    "description": "Create two contexts, delete non-current",
    "steps": [
      {"args": ["ctx", "create", "keep"],    "expect_exit": 0},
      {"args": ["ctx", "create", "remove"],  "expect_exit": 0},
      {"args": ["ctx", "use", "keep"],       "expect_exit": 0},
      {"args": ["ctx", "delete", "remove"],  "expect_exit": 0},
      {"args": ["ctx", "list"],              "expect_exit": 0, "expect_stdout_not_contains": ["remove"]}
    ]
  },
  {
    "name": "ctx_delete_current_fails",
    "description": "Cannot delete the current context",
    "steps": [
      {"args": ["ctx", "create", "only"], "expect_exit": 0},
      {"args": ["ctx", "delete", "only"], "expect_exit": 1}
    ]
  },
  {
    "name": "ctx_create_duplicate_fails",
    "description": "Creating a context with an existing name fails",
    "steps": [
      {"args": ["ctx", "create", "dup"], "expect_exit": 0},
      {"args": ["ctx", "create", "dup"], "expect_exit": 1}
    ]
  },
  {
    "name": "ctx_create_invalid_name",
    "description": "Invalid context names are rejected",
    "steps": [
      {"args": ["ctx", "create", "a/b"],     "expect_exit": 1},
      {"args": ["ctx", "create", "../evil"],  "expect_exit": 1},
      {"args": ["ctx", "create", ".hidden"],  "expect_exit": 1},
      {"args": ["ctx", "create", "current"],  "expect_exit": 1}
    ]
  },
  {
    "name": "key_show_with_seed",
    "description": "Inject a known private key, verify public key output is identical across languages",
    "seed_key": true,
    "steps": [
      {"args": ["ctx", "create", "test"], "expect_exit": 0},
      {"args": ["key", "show"],           "expect_exit": 0, "expect_stdout_match_seed_pubkey": true}
    ]
  },
  {
    "name": "config_path",
    "description": "Config path contains context name",
    "steps": [
      {"args": ["ctx", "create", "myctx"], "expect_exit": 0},
      {"args": ["config", "path"],         "expect_exit": 0, "expect_stdout_contains": ["myctx"]}
    ]
  },
  {
    "name": "config_show",
    "description": "Config show outputs config with network settings",
    "steps": [
      {"args": ["ctx", "create", "cfg"], "expect_exit": 0},
      {"args": ["config", "show"],       "expect_exit": 0, "expect_stdout_contains": ["private_key", "tun_ipv4"]}
    ]
  },
  {
    "name": "filesystem_structure",
    "description": "Verify the on-disk layout after creating contexts",
    "steps": [
      {"args": ["ctx", "create", "prod"],  "expect_exit": 0},
      {"args": ["ctx", "create", "stage"], "expect_exit": 0}
    ],
    "expect_files": [
      "current",
      "prod/private.key",
      "prod/data",
      "stage/private.key",
      "stage/data"
    ]
  },
  {
    "name": "version",
    "description": "Version command outputs version string",
    "steps": [
      {"args": ["--version"], "expect_exit": 0, "expect_stdout_contains": ["zigor"]}
    ]
  }
]
